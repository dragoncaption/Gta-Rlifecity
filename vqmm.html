<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>V√≤ng Quay RLIFE CITY</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at center, #1e1e2f, #111);
      font-family: Arial, sans-serif;
      overflow: hidden;
      flex-direction: column;
    }
    canvas {
      border-radius: 50%;
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.8), 0 0 80px rgba(255, 165, 0, 0.5);
    }
    #spin {
      margin-top: 30px;
      padding: 15px 40px;
      font-size: 20px;
      font-weight: bold;
      color: white;
      background: linear-gradient(135deg, #ffae00, #ff5500);
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 5px 20px rgba(0,0,0,0.6);
      transition: 0.2s;
    }
    #spin:disabled {
      background: gray;
      cursor: not-allowed;
      box-shadow: none;
    }
    #spin:hover:enabled {
      transform: scale(1.08);
    }
    #result {
      margin-top: 20px;
      font-size: 22px;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 0 0 10px black;
    }
    #countdown {
      margin-top: 10px;
      font-size: 18px;
      color: #ffae00;
      text-shadow: 0 0 8px black;
    }

    /* Popup */
    #popupOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #popupBox {
      background: #222;
      padding: 30px 40px;
      border-radius: 15px;
      text-align: center;
      color: #ffd700;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 0 30px rgba(255,215,0,0.7);
      animation: popupScale 0.3s ease;
    }
    #popupBox button {
      margin-top: 20px;
      padding: 10px 25px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: linear-gradient(135deg, #ffae00, #ff5500);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      transition: 0.2s;
    }
    #popupBox button:hover {
      transform: scale(1.05);
    }
    @keyframes popupScale {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <canvas id="wheel" width="600" height="600"></canvas>
  <button id="spin">QUAY NGAY</button>
  <div id="result"></div>
  <div id="countdown"></div>

  <!-- Popup -->
  <div id="popupOverlay">
    <div id="popupBox">
      <div id="popupMessage"></div>
      <button id="closePopup">ƒê√≥ng</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const names = [
      "500.000$", "10.000$", "25.000$", "H·∫πn g·∫∑p l·∫°i",
      "Carbine Rifle", "H·∫πn g·∫∑p l·∫°i", "50.000$", "Bullpup Rifle",
      "Bullpup MkII", "200.000$", "H·∫πn g·∫∑p l·∫°i", "1 C√¢y c·∫ßn c√¢u"
    ];
    const colors = ["#e74c3c","#f39c12","#27ae60","#2980b9","#8e44ad","#d35400"];
    const arc = (2 * Math.PI) / names.length;

    let angle = 0;
    let spinning = false;

    function drawWheel() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < names.length; i++) {
        const start = angle + i * arc;
        ctx.beginPath();
        ctx.fillStyle = colors[i % colors.length];
        ctx.moveTo(300, 300);
        ctx.arc(300, 300, 280, start, start + arc);
        ctx.lineTo(300, 300);
        ctx.fill();

        ctx.save();
        ctx.translate(300, 300);
        ctx.rotate(start + arc / 2);
        ctx.textAlign = "center";
        ctx.font = "bold 22px Arial";
        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.lineWidth = 4;
        ctx.strokeText(names[i], 200, 10);
        ctx.fillText(names[i], 200, 10);
        ctx.restore();
      }

      const logo = new Image();
      logo.src = "logo.png";
      logo.onload = () => {
        ctx.save();
        ctx.beginPath();
        ctx.arc(300, 300, 100, 0, Math.PI * 2);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(logo, 200, 200, 200, 200);
        ctx.restore();
      };

      ctx.save();
      ctx.fillStyle = "red";
      ctx.beginPath();
      ctx.moveTo(280, 20);
      ctx.lineTo(320, 20);
      ctx.lineTo(300, 70);
      ctx.closePath();
      ctx.fill();
      ctx.strokeStyle = "white";
      ctx.lineWidth = 3;
      ctx.stroke();
      ctx.restore();
    }

    drawWheel();

    const spinBtn = document.getElementById("spin");
    const resultDiv = document.getElementById("result");
    const countdownDiv = document.getElementById("countdown");
    const popupOverlay = document.getElementById("popupOverlay");
    const popupMessage = document.getElementById("popupMessage");
    const closePopup = document.getElementById("closePopup");

    function checkSpinStatus() {
      const lastSpin = localStorage.getItem("lastSpinDate");
      const today = new Date().toLocaleDateString();

      if (lastSpin === today) {
        spinBtn.disabled = true;
        showCountdown();
      } else {
        spinBtn.disabled = false;
        countdownDiv.innerText = "";
      }
    }

    function showCountdown() {
      function updateCountdown() {
        const now = new Date();
        const tomorrow = new Date();
        tomorrow.setHours(24,0,0,0);
        const diff = tomorrow - now;

        if (diff <= 0) {
          countdownDiv.innerText = "‚è∞ ƒê√£ t·ªõi 00:00! B·∫°n c√≥ th·ªÉ quay l·∫°i.";
          checkSpinStatus();
          return;
        }

        const hours = Math.floor(diff / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        countdownDiv.innerText = `‚è≥ C√≤n ${hours}h ${minutes}m ${seconds}s ƒë·ªÉ quay l·∫°i`;
      }

      updateCountdown();
      setInterval(updateCountdown, 1000);
    }

    checkSpinStatus();

    spinBtn.addEventListener("click", () => {
      if (spinning || spinBtn.disabled) return;
      spinning = true;
      resultDiv.innerText = "";
      countdownDiv.innerText = "";

      let spins = 3;
      let finalAngle = Math.random() * 2 * Math.PI;
      let targetAngle = spins * 2 * Math.PI + finalAngle;

      let duration = 4000;
      let start = null;

      function rotateWheel(timestamp) {
        if (!start) start = timestamp;
        let progress = (timestamp - start) / duration;
        if (progress > 1) progress = 1;

        let easedProgress = 1 - Math.pow(1 - progress, 3);

        angle = targetAngle * easedProgress;
        drawWheel();

        if (progress < 1) {
          requestAnimationFrame(rotateWheel);
        } else {
          const degrees = angle * 180 / Math.PI + 90;
          const index = Math.floor((360 - (degrees % 360)) / (360 / names.length)) % names.length;
          const prize = names[index];

          // Hi·ªÉn th·ªã popup
          popupMessage.innerText = `üéâ Ch√∫c m·ª´ng! B·∫°n nh·∫≠n ƒë∆∞·ª£c: ${prize} üéâ`;
          popupOverlay.style.display = "flex";

          localStorage.setItem("lastSpinDate", new Date().toLocaleDateString());
          spinning = false;
          checkSpinStatus();
        }
      }
      requestAnimationFrame(rotateWheel);
    });

    closePopup.addEventListener("click", () => {
      popupOverlay.style.display = "none";
    });
  </script>
</body>
</html>
